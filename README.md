本项目构建了一个面向多源异构、极端 non-IID 与长尾分布网络环境的联邦入侵检测系统。整个系统围绕“数据不出域”的协作原则而设计，通过本地分类器、扩散生成器以及多结构代理的协同，使每个客户端在保持隐私隔离的同时，共同参与跨域建模与稀缺类增强。系统的整体训练流程由客户端执行本地优化、服务器执行全局聚合与多视图整合构成，而最终性能通过全局端到端评估脚本进行统一测算。

项目的全局结构分为若干功能互补的模块。其中，fed/ 目录下包含 client.py 与 server.py，分别实现联邦学习的客户端逻辑与服务器逻辑。客户端负责本地数据加载、主分类器 FlowMLP 训练、扩散模型 SimpleDDPM 的学习、视图生成、门控检查、异构代理的小步训练以及每轮的验证与结果记录；服务器负责聚合来自所有客户端的扩散 score 网络权重（FedAvg），整合各类 schema 的合成样本池，驱动中央异构代理的近线训练，并在通信周期内向所有客户端广播最新全局参数。随着训练进行，客户端会生成多轮日志、混淆矩阵与曲线，而服务器则维护全局状态、合成样本池以及可能的中央代理模型。

项目中的 agents/ 目录实现了系统的多模型结构。FlowMLP 是全局通用的主分类器，负责处理原始 flow 特征；hetero.py 中的 HeteroManager 则管理 flow、temporal、graph 三类代理，并负责样本注入、维度对齐、多模型训练和近线评估；如果用户启用 temporal 或 graph 分支，对应的 TCN 或 GNN 构件也可以在此扩展。整个 HeteroManager 的设计使扩散生成的多视图样本能够被映射到不同结构的代理，从而提升模型对结构异构流量的适应能力。

扩散生成器位于 gen/ 目录，核心为 SimpleDDPM，负责依据类别条件与客户端标识生成 tabular 数据，并支持构造原始视图、去噪视图与 score_ms 等中间视图。该模块承担稀缺类增强的关键作用：系统通过计算本地类别频次并使用反频率采样，使稀缺类得到更高采样概率，从而确保扩散模型“优先”学习少数类结构并生成相应补充样本。生成的样本通过门控机制过滤，而门控逻辑位于 gate/quality_gate.py，主要使用 KS 与 MMD 指标评估生成样本与真实样本的分布一致性；门控通过后，样本会以视图形式注入异构代理或混入主分类器训练批次。

数据加载器 utils/dataset.py 实现对每个客户端独立的数据集（train/val/test CSV）的加载、标签词表的统一、批处理构造与输入清洗。IPC 通信工具位于 utils/ipc.py，负责将 numpy 数组压缩为二进制 blob 或从 blob 中恢复。整个项目在运行过程中会持续产生日志与图像，outs/ 目录保存每轮曲线、混淆矩阵、门控结果、视图分发统计以及扩散诊断数据；logs/ 目录保存训练过程中所有关键参数、验证结果与端到端性能。

训练全部完成后，global_eval.py 用于对所有客户端的最终端到端结果进行统一评估。该脚本自动遍历各客户端的 val_e2e 混淆矩阵，将不同客户端的类别维度对齐后累加成为全局混淆矩阵，计算整体系统的 Accuracy、Precision-macro、Recall-macro 与 F1-macro，并生成最终的全局性能报告。这部分结果可直接作为论文中的“整体系统表现”。

综上，本项目构建了一个完备的联邦入侵检测实验平台，从数据加载、联邦通信、模型训练、扩散增强、门控、异构代理优化再到全局汇总评估，形成了一个可复现、可扩展、具备完整实验链路的研究系统，适用于 IoT/IIoT、云边端架构以及其他典型多源异构安全场景。整个项目不仅能够验证扩散生成模型在长尾场景中的增强能力，也能够展示异构代理在多结构输入下的性能优势，是一个适合科研发表、工程部署与模型验证的联邦学习完整框架。
